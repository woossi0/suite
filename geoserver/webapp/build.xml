<project name="geoserver" default="build">
  <import file="../../build/common.xml"/>

  <property name="data.dir" value="../data_dir/target"/>
  <property name="war.dir" value="target/geoserver"/>
  <property name="war.file" value="${war.dir}.war"/>

  <target name="build" depends="init" description="Builds project">
    <antcall target="mvn">
        <param name="goals" value="install"/>
    </antcall>
  </target>

  <target name="clean" depends="destroy"/>

  <target name="assemble">
    <available file="${data.dir}/global.xml" property="dataDirIsAvailable"/>
    <fail message="Data dir ${data.dir} not present, build ../data_dir first"
      unless="dataDirIsAvailable"/>  

    <mkdir dir="${war.dir}/data"/>
    <copy todir="${war.dir}/data">
      <fileset dir="${data.dir}"/>
    </copy>

    <delete file="${war.file}"/>
    <jar destfile="${war.file}" basedir="${war.dir}"/>

    <antcall target="assemble-artifact">
      <param name="includes" value="*.war"/>
    </antcall>
  </target>

  <target name="publish" depends="publish-artifact"/>
</project>
